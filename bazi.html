<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¥­å…«å­—å‘½ç›¤èˆ‡æµå¹´åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <style>
        :root { --primary: #c0392b; --secondary: #d35400; --bg: #fdfaf6; }
        body { font-family: -apple-system, "Noto Sans TC", sans-serif; background-color: var(--bg); margin: 0; padding: 15px; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #eee; }
        h2 { text-align: center; color: var(--primary); margin-bottom: 20px; }
        .form-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px; -webkit-appearance: none; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        #result { margin-top: 25px; display: none; border-top: 2px dashed #eee; padding-top: 20px; }
        .bazi-table { width: 100%; border-collapse: collapse; margin: 15px 0; background: #fff; }
        .bazi-table th, .bazi-table td { border: 1px solid #ddd; padding: 12px 5px; text-align: center; width: 25%; }
        .bazi-table th { background: #f8f8f8; font-size: 13px; color: #777; }
        .ganzhi { font-size: 22px; font-weight: bold; color: #222; line-height: 1.2; }
        
        .section-title { background: var(--primary); color: white; padding: 5px 12px; border-radius: 4px; display: inline-block; margin-bottom: 10px; font-size: 14px; }
        .card { background: #fffcf5; padding: 15px; border: 1px solid #f1e0c6; border-radius: 8px; margin-bottom: 15px; line-height: 1.6; font-size: 15px; }
        .highlight { color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ”® å…«å­—å‘½ç›¤åˆ†æ</h2>
    
    <div class="form-group">
        <label>å…¬æ›†å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="birthDate" value="1995-01-01">
    </div>
    <div class="form-group">
        <label>å‡ºç”Ÿæ™‚è¾°</label>
        <select id="birthHour">
            <option value="0">00:00 - 00:59 (å­æ™‚)</option>
            <option value="1">01:00 - 02:59 (ä¸‘æ™‚)</option>
            <option value="3">03:00 - 04:59 (å¯…æ™‚)</option>
            <option value="5">05:00 - 06:59 (å¯æ™‚)</option>
            <option value="7">07:00 - 08:59 (è¾°æ™‚)</option>
            <option value="9">09:00 - 10:59 (å·³æ™‚)</option>
            <option value="11">11:00 - 12:59 (åˆæ™‚)</option>
            <option value="13">13:00 - 14:59 (æœªæ™‚)</option>
            <option value="15">15:00 - 16:59 (ç”³æ™‚)</option>
            <option value="17">17:00 - 18:59 (é…‰æ™‚)</option>
            <option value="19">19:00 - 20:59 (æˆŒæ™‚)</option>
            <option value="21">21:00 - 22:59 (äº¥æ™‚)</option>
            <option value="23">23:00 - 23:59 (å­æ™‚)</option>
        </select>
    </div>
    
    <button onclick="calculateBazi()">é–‹å§‹æ’ç›¤åˆ†æ</button>

    <div id="result">
        <div class="section-title">è¾²æ›†èˆ‡æ’ç›¤</div>
        <div id="lunarInfo" style="margin-bottom:10px; font-size:14px;"></div>
        
        <table class="bazi-table">
            <thead>
                <tr><th>å¹´æŸ±</th><th>æœˆæŸ±</th><th>æ—¥æŸ±</th><th>æ™‚æŸ±</th></tr>
            </thead>
            <tbody id="baziGanzhi"></tbody>
        </table>

        <div class="section-title">å‘½æ ¼æ€§æ ¼åˆ†æ</div>
        <div class="card" id="characterAnalysis"></div>

        <div class="section-title" id="yearTitle">æµå¹´é‹å‹¢å»ºè­°</div>
        <div class="card" style="border-left: 5px solid #d35400;" id="fortuneAnalysis"></div>
    </div>
</div>

<script>
    function calculateBazi() {
        try {
            const dateInput = document.getElementById('birthDate').value;
            const hour = parseInt(document.getElementById('birthHour').value);
            
            if (!dateInput) {
                alert('è«‹å…ˆé¸æ“‡å‡ºç”Ÿæ—¥æœŸ');
                return;
            }

            const d = new Date(dateInput);
            // åˆå§‹åŒ– Lunar ç‰©ä»¶
            const solar = Solar.fromYmdHms(d.getFullYear(), d.getMonth() + 1, d.getDate(), hour, 0, 0);
            const lunar = solar.getLunar();
            const eb = lunar.getEightChar();
            
            // 1. é¡¯ç¤ºè¾²æ›†è³‡è¨Š
            document.getElementById('lunarInfo').innerHTML = `
                ğŸ“… è¾²æ›†ï¼š${lunar.getYearInGanZhi()}å¹´ ${lunar.getMonthInChinese()}æœˆ ${lunar.getDayInChinese()}<br>
                ğŸ¾ ç”Ÿè‚–ï¼šå±¬${lunar.getYearShengXiao()}
            `;

            // 2. é¡¯ç¤ºå…«å­—
            const baziRow = `
                <tr>
                    <td class="ganzhi">${eb.getYearGan()}<br>${eb.getYearZhi()}</td>
                    <td class="ganzhi">${eb.getMonthGan()}<br>${eb.getMonthZhi()}</td>
                    <td class="ganzhi">${eb.getDayGan()}<br>${eb.getDayZhi()}</td>
                    <td class="ganzhi">${eb.getHourGan()}<br>${eb.getHourZhi()}</td>
                </tr>
            `;
            document.getElementById('baziGanzhi').innerHTML = baziRow;

            // 3. æ€§æ ¼åˆ†æ (åŸºæ–¼æ—¥å…ƒ)
            const dayGan = eb.getDayGan();
            const charData = getCharacterData(dayGan);
            document.getElementById('characterAnalysis').innerHTML = `
                æ‚¨çš„æ—¥å…ƒç‚ºã€Œ<span class="highlight">${dayGan}</span>ã€ï¼Œå±¬æ–¼ <span class="highlight">${charData.element}</span>ã€‚<br>
                ${charData.desc}
            `;

            // 4. æµå¹´åˆ†æ (ç•¶å‰å¹´ä»½)
            const currentYear = new Date().getFullYear();
            const currentLunar = Lunar.fromDate(new Date());
            const currentYearGanZhi = currentLunar.getYearInGanZhi();
            const currentYearGan = currentYearGanZhi.substring(0, 1);
            
            document.getElementById('yearTitle').innerText = `${currentYear} (${currentYearGanZhi}) æµå¹´é‹å‹¢`;
            document.getElementById('fortuneAnalysis').innerHTML = getFortuneAdvice(dayGan, currentYearGan);

            // é¡¯ç¤ºçµæœå€åŸŸ
            document.getElementById('result').style.display = 'block';
            window.scrollTo({ top: document.getElementById('result').offsetTop, behavior: 'smooth' });

        } catch (error) {
            console.error(error);
            alert('ç¨‹å¼åŸ·è¡Œå‡ºéŒ¯ï¼š' + error.message + '\nè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚');
        }
    }

    function getCharacterData(gan) {
        const mapping = {
            'ç”²': { element: 'é™½æœ¨', desc: 'å¦‚åƒå¤©å¤§æ¨¹ï¼Œå……æ»¿ä»æ…ˆä¹‹å¿ƒï¼Œå‘ä¸Šç™¼å±•çš„å‹•åŠ›å¼·ã€‚æ€§æ ¼æ­£ç›´ï¼Œä½†æœ‰æ™‚éæ–¼å›ºåŸ·ï¼Œä¸æ“…é•·è®Šé€šã€‚' },
            'ä¹™': { element: 'é™°æœ¨', desc: 'å¦‚æ”€æ´è—¤è”“ï¼Œç”Ÿå‘½åŠ›æ¥µå¼·ä¸”æº«æŸ”é«”è²¼ã€‚é©æ‡‰èƒ½åŠ›å„ªç•°ï¼Œä½†å®¹æ˜“å—ç’°å¢ƒå½±éŸ¿è€Œç¼ºä¹ä¸»è¦‹ã€‚' },
            'ä¸™': { element: 'é™½ç«', desc: 'å¦‚å¤ªé™½èˆ¬ç†±çƒˆï¼Œç†±æƒ…å¤§æ–¹ï¼Œç›´çˆ½ä¸”å……æ»¿æ­£èƒ½é‡ã€‚ç¼ºé»æ˜¯è„¾æ°£ä¾†å¾—å¿«å»å¾—ä¹Ÿå¿«ï¼Œæœ‰æ™‚ç¼ºä¹è€æ€§ã€‚' },
            'ä¸': { element: 'é™°ç«', desc: 'å¦‚ç‡­å…‰ç‡ˆç«ï¼Œæº«æš–ç´°è†©ï¼Œè§€å¯ŸåŠ›æ¥µå¼·ã€‚å¤–è¡¨å¹³éœä½†å…§å¿ƒæ€è€ƒå¾ˆå¤šï¼Œå±¬æ–¼å¤§å™¨æ™šæˆçš„é¡å‹ã€‚' },
            'æˆŠ': { element: 'é™½åœŸ', desc: 'å¦‚é«˜å±±åšåœŸï¼Œç©©é‡è¸å¯¦ï¼Œéå¸¸å®ˆä¿¡ç”¨ã€‚åšäº‹æœ‰å§‹æœ‰çµ‚ï¼Œä½†æœ‰æ™‚æœƒçµ¦äººæ²‰æ‚¶ã€ä¸å¤ æµªæ¼«çš„æ„Ÿè¦ºã€‚' },
            'å·±': { element: 'é™°åœŸ', desc: 'å¦‚ç”°åœ’ä¹‹åœŸï¼ŒåŒ…å®¹åŠ›æ¥µå¤§ï¼Œå¤šæ‰å¤šè—ã€‚å…§å¿ƒç´°è†©ä¸”æ‡‚å¾—é«”è«’ä»–äººï¼Œä½†æœ‰æ™‚å®¹æ˜“ç³¾çµæ–¼å°äº‹ã€‚' },
            'åºš': { element: 'é™½é‡‘', desc: 'å¦‚å‰›éµåˆ©åŠï¼Œå‰›æ¯…æœæ–·ï¼Œæ¥µå…·ä¿ ç¾©å¿ƒè…¸ã€‚è¾¦äº‹æ•ˆç‡é«˜ï¼Œä½†èªªè©±éæ–¼ç›´ç™½ï¼Œå®¹æ˜“åœ¨ç„¡æ„ä¸­å¾—ç½ªäººã€‚' },
            'è¾›': { element: 'é™°é‡‘', desc: 'å¦‚ç å¯¶é¦–é£¾ï¼Œç²¾ç·»è¯ç¾ï¼Œè‡ªå°Šå¿ƒå¼·ã€‚è¿½æ±‚ç”Ÿæ´»å“è³ªï¼Œè…¦è¢‹éˆæ´»ï¼Œä½†è¦æ³¨æ„éæ–¼æ•æ„Ÿã€‚' },
            'å£¬': { element: 'é™½æ°´', desc: 'å¦‚æ±Ÿæ²³å¤§æµ·ï¼Œæœ‰å¤§æ™ºæ…§ï¼Œæ ¼å±€å»£é—Šã€‚å–œæ­¡è‡ªç”±å¥”æ”¾çš„æ„Ÿè¦ºï¼Œè°æ˜ä½†æœ‰æ™‚æœƒå› å¤ªééš¨æ€§è€ŒéŒ¯å¤±è‰¯æ©Ÿã€‚' },
            'ç™¸': { element: 'é™°æ°´', desc: 'å¦‚é›¨éœ²æ¸…æ³‰ï¼ŒæŸ”æƒ…ä¸”å…§æ–‚ï¼Œæƒ³åƒåŠ›è±å¯Œã€‚æ‡‚å¾—é‹ç”¨æŸ”æ€§åŠ›é‡è§£æ±ºå•é¡Œï¼Œä½†æƒ…ç·’èµ·ä¼ç›¸å°è¼ƒå¤§ã€‚' }
        };
        return mapping[gan];
    }

    function getFortuneAdvice(dayGan, yearGan) {
        const elements = {
            'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ', 
            'å·±': 'åœŸ', 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´'
        };
        
        const self = elements[dayGan];
        const year = elements[yearGan];

        // ç°¡æ˜“äº”è¡Œé—œä¿‚åˆ¤æ–·æµå¹´
        if (self === year) {
            return `<b>ã€åŒæ°£ç›¸æ±‚ã€‘</b>ï¼šä»Šå¹´ç«¶çˆ­å£“åŠ›è¼ƒå¤§ï¼Œæœƒé‡åˆ°å¾ˆå¤šå¿—åŒé“åˆçš„æœ‹å‹æˆ–ç«¶çˆ­å°æ‰‹ã€‚å»ºè­°å¤šè½å–ä»–äººæ„è¦‹ï¼Œä¸å®œå­¤è»å¥®æˆ°ï¼Œé˜²è²¡ç‰©æè€—ã€‚`;
        }
        
        const relations = {
            'æœ¨': { 'ç«': 'é£Ÿå‚·æµå¹´ï¼šæ‰è¯ç™¼æ®ä¹‹å¹´ï¼Œåˆ©æ±‚å­¸ã€å‰µæ„ã€‚', 'åœŸ': 'è²¡æ˜Ÿæµå¹´ï¼šæ©Ÿæœƒè®Šå¤šï¼Œè²¡é‹è¼ƒæ—ºï¼Œåˆ©æ–¼æ±‚è²¡ã€‚', 'é‡‘': 'å®˜æ®ºæµå¹´ï¼šå£“åŠ›è¼ƒå¤§ï¼Œåˆ©æ–¼æ™‰å‡ä½†è¦æ³¨æ„éå‹ã€‚', 'æ°´': 'å°æ˜Ÿæµå¹´ï¼šè²´äººé‹æ—ºï¼Œé©åˆå­¸ç¿’èˆ‡èª¿é¤Šç”Ÿæ¯ã€‚' },
            'ç«': { 'åœŸ': 'é£Ÿå‚·æµå¹´ï¼šæ€ç¶­æ´»èºï¼Œé©åˆå±•ç¾è‡ªæˆ‘ï¼Œæ³¨æ„å£èˆŒã€‚', 'é‡‘': 'è²¡æ˜Ÿæµå¹´ï¼šè²¡é‹èµ°å¼·ï¼Œåˆ©æ–¼ç¶“å•†æˆ–æŠ•è³‡ã€‚', 'æœ¨': 'å°æ˜Ÿæµå¹´ï¼šé•·è¼©ç·£ä½³ï¼Œèƒ½å¾—åˆ°é•·è¼©æˆ–ä¸Šå¸çš„ææ”œã€‚', 'æ°´': 'å®˜æ®ºæµå¹´ï¼šè²¬ä»»åŠ é‡ï¼Œéœ€è¬¹è¨€æ…è¡Œï¼Œæ³¨æ„è·å ´é—œä¿‚ã€‚' },
            'åœŸ': { 'é‡‘': 'é£Ÿå‚·æµå¹´ï¼šæƒ…ç·’èµ·ä¼è¼ƒå¤§ï¼Œå®œæ”¾é¬†å¿ƒæƒ…ï¼Œåˆ©æ–¼è—è¡“èˆ‡è¡¨é”ã€‚', 'æ°´': 'è²¡æ˜Ÿæµå¹´ï¼šè²¡æºå»£é€²ï¼Œæ„Ÿæƒ…ç”Ÿæ´»è¼ƒè±å¯Œã€‚', 'ç«': 'å°æ˜Ÿæµå¹´ï¼šå¿ƒéˆæˆé•·ä¹‹å¹´ï¼Œé©åˆè³¼è²·æˆ¿ç”¢æˆ–å®‰é “ç”Ÿæ´»ã€‚', 'æœ¨': 'å®˜æ®ºæµå¹´ï¼šé¢è‡¨æŒ‘æˆ°èˆ‡è¦ç¯„ï¼Œæ˜¯ç£¨ç·´æ„å¿—çš„å¥½æ™‚æ©Ÿã€‚' },
            'é‡‘': { 'æ°´': 'é£Ÿå‚·æµå¹´ï¼šå‰µæ„å™´ç™¼ï¼Œåˆ©æ–¼æ¥­å‹™é–‹æ‹“ï¼Œæ³¨æ„ä¿é‡èº«é«”ã€‚', 'æœ¨': 'è²¡æ˜Ÿæµå¹´ï¼šåˆ©æ–¼æ¥­å‹™æ”¶ç›Šï¼Œå‹è€Œæœ‰ç²ã€‚', 'åœŸ': 'å°æ˜Ÿæµå¹´ï¼šè²´äººæ‰¶æŒï¼Œç©©å®šä¸­æ±‚ç™¼å±•ã€‚', 'ç«': 'å®˜æ®ºæµå¹´ï¼šæ¬ŠåŠ›è·ä½æå‡ä¹‹å¹´ï¼Œå£“åŠ›ä¼´éš¨æ©Ÿé‡ã€‚' },
            'æ°´': { 'æœ¨': 'é£Ÿå‚·æµå¹´ï¼šè¡Œå‹•åŠ›å¼·ï¼Œé©åˆé–‹å±•æ–°è¨ˆç•«ï¼Œåˆ©