<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>八字命盤</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            font-family: -apple-system, sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 18px 0; 
            padding: 18px; 
            color: #333; 
            line-height: 1.6;
            min-height: 100vh;
            font-size: 18px; /* 增加基礎字體大小 */
        }
        .card { 
            max-width: 500px; 
            margin: 0 auto; 
            background: #fff; 
            border-radius: 18px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
            overflow: hidden; 
        }
        .header { 
            background: linear-gradient(to right, #b33939, #d63031); 
            color: #fff; 
            padding: 18px; 
            text-align: center; 
            font-size: 22px; 
            font-weight: bold; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        .p-20 { 
            padding: 20px; 
        }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #555;
            font-size: 17px; /* 增加標籤字體大小 */
        }
        input, select { 
            width: 100%; 
            padding: 14px; 
            margin-bottom: 22px; 
            border: 2px solid #e0e0e0; 
            border-radius: 10px; 
            font-size: 18px; 
            box-sizing: border-box; 
            transition: border 0.3s;
        }
        input:focus, select:focus {
            border-color: #b33939;
            outline: none;
            box-shadow: 0 0 0 3px rgba(179, 57, 57, 0.1);
        }
        button { 
            width: 100%; 
            padding: 17px; 
            background: linear-gradient(to right, #b33939, #d63031); 
            color: white; 
            border: none; 
            border-radius: 10px; 
            font-size: 18px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(179, 57, 57, 0.2);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(179, 57, 57, 0.3);
        }
        
        #result { 
            display: none; 
            margin-top: 25px; 
            border-top: 2px solid #eee; 
            padding-top: 20px; 
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bazi-row { 
            display: flex; 
            justify-content: space-between; 
            margin: 20px 0; 
        }
        .bazi-item { 
            flex: 1; 
            text-align: center; 
            background: linear-gradient(145deg, #fff9e6, #ffeaa7); 
            margin: 0 3px; 
            padding: 12px 5px; 
            border-radius: 8px; 
            border: 2px solid #fdcb6e;
            box-shadow: 0 3px 5px rgba(0,0,0,0.05);
        }
        .bazi-t { 
            font-size: 14px; /* 增加八字標題字體大小 */
            color: #888; 
            margin-bottom: 5px;
        }
        .bazi-v { 
            font-size: 24px; /* 增加八字內容字體大小 */
            font-weight: bold; 
            color: #d63031; 
            text-shadow: 1px 1px 1px rgba(0,0,0,0.1);
        }
        
        .desc-box { 
            background: #f9f9f9; 
            border-left: 5px solid #b33939; 
            padding: 18px; 
            margin-top: 25px; 
            font-size: 18px; /* 增加描述框字體大小 */
            line-height: 1.7;
            border-radius: 0 10px 10px 0;
            transition: transform 0.3s;
        }
        .blue-border { 
            border-left-color: #2980b9; 
            background: linear-gradient(to right, #f0f7ff, #e3f2fd); 
        }
        .green-border { 
            border-left-color: #27ae60; 
            background: linear-gradient(to right, #f0fff4, #e8f5e9); 
        }
        .purple-border { 
            border-left-color: #8e44ad; 
            background: linear-gradient(to right, #f5eef8, #e8daef); 
        }
        .orange-border { 
            border-left-color: #e67e22; 
            background: linear-gradient(to right, #fef5e7, #fdebd0); 
        }
        
        .fortune-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 0;
        }
        
        .fortune-category {
            background: rgba(255,255,255,0.8);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #eee;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            font-size: 18px; /* 增加運勢分類字體大小 */
        }
        
        h3 {
            color: #b33939;
            margin-top: 0;
            margin-bottom: 12px;
            font-size: 20px; /* 增加標題字體大小 */
            border-bottom: 2px solid #ffeaa7;
            padding-bottom: 6px;
        }
        
        .blue-border h3 {
            color: #2980b9;
            border-bottom-color: #a5d8ff;
        }
        
        .green-border h3 {
            color: #27ae60;
            border-bottom-color: #a3e4d7;
        }
        
        .purple-border h3 {
            color: #8e44ad;
            border-bottom-color: #d2b4de;
        }
        
        .orange-border h3 {
            color: #e67e22;
            border-bottom-color: #f5b041;
        }
        
        .loading {
            text-align: center;
            padding: 25px;
            color: #666;
            font-size: 18px; /* 增加載入文字大小 */
        }
        
        .year-tabs {
            display: flex;
            margin-bottom: 18px;
            border-bottom: 2px solid #eee;
        }
        
        .year-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            color: #555;
            font-size: 18px; /* 增加年份標籤字體大小 */
        }
        
        .year-tab.active {
            background: #b33939;
            color: white;
        }
        
        .year-tab.blue {
            background: #f0f7ff;
            color: #2980b9;
        }
        
        .year-tab.blue.active {
            background: #2980b9;
            color: white;
        }
        
        .year-tab.green {
            background: #f0fff4;
            color: #27ae60;
        }
        
        .year-tab.green.active {
            background: #27ae60;
            color: white;
        }
        
        .year-content {
            display: none;
        }
        
        .year-content.active {
            display: block;
        }
        
        .wuxing-chart-container {
            margin: 18px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .wuxing-stats {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 18px;
        }
        
        .wuxing-item {
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
            font-size: 18px; /* 增加五行項目字體大小 */
        }
        
        .metal { background: linear-gradient(to bottom, #95a5a6, #7f8c8d); }
        .wood { background: linear-gradient(to bottom, #27ae60, #229954); }
        .water { background: linear-gradient(to bottom, #3498db, #2980b9); }
        .fire { background: linear-gradient(to bottom, #e74c3c, #c0392b); }
        .earth { background: linear-gradient(to bottom, #e67e22, #d35400); }
        
        .xishen-box {
            background: #fffde7;
            padding: 12px;
            border-radius: 8px;
            margin-top: 18px;
            border: 1px solid #fdcb6e;
            font-size: 18px; /* 增加喜用神框字體大小 */
        }
        
        .bone-weight-box {
            text-align: center;
            padding: 18px;
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            border-radius: 10px;
            margin: 18px 0;
            box-shadow: 0 4px 8px rgba(142, 68, 173, 0.3);
        }
        
        .bone-weight-value {
            font-size: 38px; /* 增加骨重數值字體大小 */
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .bone-weight-title {
            font-size: 20px; /* 增加骨重標題字體大小 */
            margin-bottom: 5px;
        }
        
        .bone-song-box {
            background: #f5eef8;
            padding: 18px;
            border-radius: 8px;
            margin-top: 18px;
            border-left: 4px solid #8e44ad;
            /* 移除 font-style: italic; 以取消斜體 */
            line-height: 1.8;
            font-size: 18px; /* 增加稱骨歌字體大小 */
        }
        
        @media (max-width: 480px) {
            .fortune-grid {
                grid-template-columns: 1fr;
            }
            .bazi-item {
                padding: 10px 3px;
            }
            .bazi-v {
                font-size: 22px; /* 調整手機上的八字內容字體大小 */
            }
            .wuxing-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            body {
                font-size: 18px; /* 手機上基礎字體稍小 */
            }
            .desc-box {
                font-size: 18px; /* 手機上描述框字體大小 */
            }
        }
        
        .tip-box {
            background: #fffde7;
            border-left: 4px solid #fdcb6e;
            padding: 12px;
            margin: 18px 0;
            border-radius: 0 8px 8px 0;
            font-size: 18px; /* 增加提示框字體大小 */
            color: #666;
        }
        
        /* 增加內文段落文字大小 */
        p {
            font-size: 18px;
            line-height: 1.7;
        }
        
        /* 增加運勢內容文字大小 */
        .fortune-category p {
            font-size: 18px;
        }
    </style>
</head>
<body>

<div class="card">
    <div class="header">八字命盤分析系統</div>
    <div class="p-20">
        <label>公曆出生日期</label>
        <input type="date" id="myDate" value="1995-01-01">
        
        <label>出生時辰</label>
        <select id="myHour">
            <option value="0">00:00 (子時)</option><option value="1">01:00 (丑時)</option>
            <option value="3">03:00 (寅時)</option><option value="5">05:00 (卯時)</option>
            <option value="7">07:00 (辰時)</option><option value="9">09:00 (巳時)</option>
            <option value="11">11:00 (午時)</option><option value="13">13:00 (未時)</option>
            <option value="15">15:00 (申時)</option><option value="17">17:00 (酉時)</option>
            <option value="19">19:00 (戌時)</option><option value="21">21:00 (亥時)</option>
            <option value="23">23:00 (子時)</option>
        </select>

        <button onclick="run()">開始分析</button>

        <div id="result">
            <div id="lunarInfo" style="text-align:center; color:#b33939; font-weight:bold; margin-bottom:18px; padding:12px; background:#fff9e6; border-radius:8px; border:1px solid #ffeaa7; font-size:17px;"></div>
            
            <div class="bazi-row" id="baziDisplay"></div>

            <div class="desc-box">
                <b style="color:#b33939; font-size:19px;">【日元與性格分析】</b><br>
                <div id="charText" class="loading">分析中...</div>
            </div>

            <div class="desc-box purple-border">
                <b style="color:#8e44ad; font-size:19px;">【八字五行比例與喜用神】</b><br>
                <div id="wuxingText" class="loading">分析中...</div>
            </div>

            <div class="desc-box orange-border">
                <b style="color:#e67e22; font-size:19px;">【袁天罡稱骨算命】</b><br>
                <div id="boneWeightText" class="loading">計算中...</div>
            </div>

            <div class="year-tabs">
                <button class="year-tab blue active" onclick="switchYear('2025')">2025乙巳年</button>
                <button class="year-tab green" onclick="switchYear('2026')">2026丙午年</button>
            </div>
            
            <div class="desc-box blue-border">
                <div id="year2025Content" class="year-content active">
                    <b style="color:#2980b9; font-size:19px;">【2025 乙巳年運勢建議】</b><br>
                    <div id="yearText2025" class="loading">分析中...</div>
                </div>
                
                <div id="year2026Content" class="year-content">
                    <b style="color:#27ae60; font-size:19px;">【2026 丙午年運勢建議】</b><br>
                    <div id="yearText2026" class="loading">分析中...</div>
                </div>
            </div>
            
            <div class="tip-box">
                💡 提示：八字分析與稱骨算命僅供參考，命運掌握在自己手中。喜用神分析可作為調和命理、改善運勢的參考方向。
            </div>
        </div>
    </div>
</div>

<script>
    // 日元分析資料
    const dayAnalysisMap = {
        '甲': {
            title: '甲木（陽木）— 大樹之命',
            characteristics: '正直不阿、積極進取、有領導才能、責任感強',
            strengths: '堅韌不拔、誠實可靠、有開創精神、做事有計劃',
            weaknesses: '過於固執、缺乏變通、有時過於自我、易忽略他人感受',
            careerSuggestions: '適合管理職、建築業、木材相關產業、教育行業',
            relationshipAdvice: '需學習傾聽與妥協，避免過度強勢'
        },
        '乙': {
            title: '乙木（陰木）— 花草之命',
            characteristics: '溫柔體貼、適應力強、心思細膩、富有同情心',
            strengths: '靈活變通、善於溝通、有藝術天分、體貼他人',
            weaknesses: '內心敏感、容易猶豫、缺乏主見、抗壓性較弱',
            careerSuggestions: '適合藝術創作、諮詢服務、園藝設計、文書工作',
            relationshipAdvice: '需建立自信心，學會表達自己的真實想法'
        },
        '丙': {
            title: '丙火（陽火）— 太陽之命',
            characteristics: '熱情開朗、光明磊落、積極主動、感染力強',
            strengths: '樂觀進取、領導能力強、執行力高、善於鼓舞他人',
            weaknesses: '脾氣急躁、缺乏耐心、有時過於衝動、容易三分鐘熱度',
            careerSuggestions: '適合演藝事業、銷售行業、公關活動、能源產業',
            relationshipAdvice: '需學習控制情緒，培養耐心與持續力'
        },
        '丁': {
            title: '丁火（陰火）— 燈燭之命',
            characteristics: '心思細膩、觀察入微、溫和有禮、重視細節',
            strengths: '思慮周全、有耐心、注重禮節、善於策劃',
            weaknesses: '容易憂慮、多疑心、缺乏安全感、易鑽牛角尖',
            careerSuggestions: '適合研究分析、策劃工作、心理諮詢、精密技術',
            relationshipAdvice: '需學習信任他人，避免過度擔心未發生的事'
        },
        '戊': {
            title: '戊土（陽土）— 高山之命',
            characteristics: '穩重可靠、誠實守信、有包容力、做事踏實',
            strengths: '責任感強、值得信賴、有耐心、實事求是',
            weaknesses: '過於保守、缺乏變通、反應較慢、不善表達',
            careerSuggestions: '適合房地產、建築工程、金融管理、農業相關',
            relationshipAdvice: '需學習表達情感，增加生活情趣'
        },
        '己': {
            title: '己土（陰土）— 田園之命',
            characteristics: '包容力強、溫和謙遜、有耐心、善於協調',
            strengths: '適應力強、善於溝通、有服務精神、懂得變通',
            weaknesses: '優柔寡斷、缺乏主見、容易妥協、自信心不足',
            careerSuggestions: '適合行政工作、人力資源、服務業、農業相關',
            relationshipAdvice: '需培養決斷力，勇敢表達自己的意見'
        },
        '庚': {
            title: '庚金（陽金）— 鋼鐵之命',
            characteristics: '剛毅果決、正義感強、有原則、不畏挑戰',
            strengths: '意志堅定、執行力強、講義氣、有擔當',
            weaknesses: '過於剛強、說話直接、缺乏圓融、易得罪人',
            careerSuggestions: '適合軍警職、法律工作、工程技術、機械相關',
            relationshipAdvice: '需學習委婉表達，多考慮他人感受'
        },
        '辛': {
            title: '辛金（陰金）— 珠寶之命',
            characteristics: '心思細膩、追求完美、氣質優雅、重視外表',
            strengths: '審美觀強、注重細節、有才華、善於交際',
            weaknesses: '過於挑剔、愛面子、抗壓性低、容易悲觀',
            careerSuggestions: '適合設計行業、珠寶業、金融分析、公關工作',
            relationshipAdvice: '需學習接受不完美，降低對他人與自己的要求'
        },
        '壬': {
            title: '壬水（陽水）— 江河之命',
            characteristics: '聰明智慧、適應力強、心胸寬闊、有膽識',
            strengths: '學習力強、有創意、善於應變、人緣佳',
            weaknesses: '做事隨性、缺乏規劃、易虎頭蛇尾、自制力不足',
            careerSuggestions: '適合貿易行業、運輸業、旅遊業、媒體工作',
            relationshipAdvice: '需培養紀律性，學習制定與執行計劃'
        },
        '癸': {
            title: '癸水（陰水）— 雨露之命',
            characteristics: '心思細膩、直覺敏銳、溫柔體貼、富有同情心',
            strengths: '觀察力強、善解人意、有藝術天分、適應力佳',
            weaknesses: '情緒起伏大、多愁善感、容易退縮、缺乏行動力',
            careerSuggestions: '適合藝術創作、心理諮詢、美容業、服務業',
            relationshipAdvice: '需學習管理情緒，培養積極行動的習慣'
        }
    };
    
    // 2025乙巳年運勢資料
    const yearlyFortune2025Map = {
        '甲': {
            overall: '2025乙巳年對甲木日主是劫財坐食神的流年，機遇與挑戰並存。乙木為劫財，代表人際關係活躍但也帶來競爭；巳火為食神，代表才華展現與創意發揮。',
            career: '職場上競爭加劇，但同時有展現能力的機會。利於團隊合作，但需注意人際關係，避免因過度自信而與同事產生摩擦。下半年有晉升或轉職機會。',
            wealth: '財運起伏較大，正財穩定但偏財需謹慎。避免合夥投資，易有財務糾紛。理財宜保守，可考慮長期穩健型投資。',
            health: '注意肝膽問題和壓力管理，適度運動有助於釋放壓力。春季需特別注意呼吸道健康。',
            relationship: '感情上易有競爭者出現，單身者需主動出擊，已婚者需加強溝通。人際交往中需注意言行，避免無意中得罪人。',
            auspiciousDirections: '東南方、西北方',
            auspiciousColors: '綠色、藍色',
            importantMonths: '農曆三月、七月、十一月'
        },
        '乙': {
            overall: '2025乙巳年對乙木日主是比肩坐傷官的流年，才華得以發揮但壓力增加。乙木為比肩，代表同儕競爭與合作；巳火為傷官，代表創造力與表達欲增強。',
            career: '競爭壓力大，但能憑藉專業能力脫穎而出。適合進修學習，提升技能。注意職場口舌是非，謹言慎行。',
            wealth: '正財收入穩定，有意外之財機會但來去匆匆。不宜進行高風險投資。可考慮與創意相關的副業。',
            health: '注意神經系統和腸胃問題，保持規律作息。夏季需防中暑與熱相關疾病。',
            relationship: '人際關係活躍，但易有口舌是非。感情上需多些包容與理解，單身者易在學習場合遇到對象。',
            auspiciousDirections: '東方、東南方',
            auspiciousColors: '綠色、紅色',
            importantMonths: '農曆二月、六月、十月'
        },
        '丙': {
            overall: '2025乙巳年對丙火日主是正印坐比肩的流年，貴人運強，學習成長佳期。乙木為正印，代表長輩貴人與學習機會；巳火為比肩，代表人際支援與合作機會。',
            career: '有上司或長輩提攜，利於職位晉升。適合考取證照、進修深造。團隊合作順暢，可藉助他人之力達成目標。',
            wealth: '財運平穩上升，正財收入增加。適合長期穩健型投資，避免投機。下半年有意外收入機會。',
            health: '注意心血管健康和眼睛保養，避免過度勞累。秋季需注意呼吸系統問題。',
            relationship: '人際關係和諧，家庭運佳。單身者易透過長輩介紹認識對象，已有伴侶者感情穩定發展。',
            auspiciousDirections: '南方、東南方',
            auspiciousColors: '紅色、紫色',
            importantMonths: '農曆四月、八月、十二月'
        },
        '丁': {
            overall: '2025乙巳年對丁火日主是偏印坐劫財的流年，學習成長與人際互動並存。乙木為偏印，代表靈感與特殊才能；巳火為劫財，代表人際互動與資源分享。',
            career: '靈感豐富，適合從事創意或研究工作。但需注意職場人際關係，避免與同事發生資源爭奪。',
            wealth: '正財穩定，偏財需謹慎。不宜進行高風險投資，理財以保守為宜。',
            health: '注意神經系統和睡眠品質，避免用腦過度。夏季需注意心血管健康。',
            relationship: '人際關係複雜，需謹慎處理。感情上需多溝通，避免誤會產生。',
            auspiciousDirections: '南方、西南方',
            auspiciousColors: '紅色、黃色'
        },
        '戊': {
            overall: '2025乙巳年對戊土日主是正官坐偏印的流年，事業發展與學習機會並存。乙木為正官，代表事業發展與責任；巳火為偏印，代表學習與思考。',
            career: '事業發展順利，有晉升機會。適合進修學習，提升專業能力。但需注意職場壓力，適時放鬆。',
            wealth: '正財收入增加，偏財運普通。適合穩健型投資，避免投機。',
            health: '注意腸胃問題和壓力管理，保持規律作息。春季需注意肝膽健康。',
            relationship: '感情穩定發展，單身者易在工作中認識對象。已婚者家庭和諧。',
            auspiciousDirections: '中央、西南方',
            auspiciousColors: '黃色、紅色'
        },
        '己': {
            overall: '2025乙巳年對己土日主是七殺坐正印的流年，挑戰與機會並存。乙木為七殺，代表挑戰與壓力；巳火為正印，代表貴人與學習。',
            career: '職場挑戰多，但同時有貴人相助。適合進修學習，提升競爭力。需注意工作壓力，適時調整。',
            wealth: '財運起伏較大，正財穩定但偏財需謹慎。不宜進行高風險投資。',
            health: '注意腸胃問題和壓力管理，保持規律作息。夏季需注意心血管健康。',
            relationship: '感情上需多溝通，避免誤會產生。單身者易在學習場合認識對象。',
            auspiciousDirections: '中央、南方',
            auspiciousColors: '黃色、紅色'
        },
        '庚': {
            overall: '2025乙巳年對庚金日主是正財坐七殺的流年，財運與挑戰並存。乙木為正財，代表穩定收入；巳火為七殺，代表挑戰與壓力。',
            career: '事業發展順利，有晉升機會。但需注意職場競爭，適時展現能力。',
            wealth: '正財收入增加，偏財運普通。適合穩健型投資，避免高風險。',
            health: '注意呼吸系統和皮膚問題，保持良好作息。秋季需注意肺部健康。',
            relationship: '感情穩定發展，單身者易在工作中認識對象。已婚者家庭和諧。',
            auspiciousDirections: '西方、西北方',
            auspiciousColors: '白色、金色'
        },
        '辛': {
            overall: '2025乙巳年對辛金日主是偏財坐正官的流年，財運與事業發展並存。乙木為偏財，代表意外收入；巳火為正官，代表事業發展。',
            career: '事業發展順利，有晉升機會。適合拓展業務，增加收入來源。',
            wealth: '偏財運佳，有意外收入機會。但需謹慎理財，避免過度消費。',
            health: '注意呼吸系統和皮膚問題，保持良好作息。夏季需注意心血管健康。',
            relationship: '感情穩定發展，單身者易在社交場合認識對象。已婚者家庭和諧。',
            auspiciousDirections: '西方、西北方',
            auspiciousColors: '白色、金色'
        },
        '壬': {
            overall: '2025乙巳年對壬水日主是傷官坐偏財的流年，才華發揮與財運並存。乙木為傷官，代表才華展現；巳火為偏財，代表意外收入。',
            career: '才華得以發揮，適合從事創意工作。但需注意職場口舌，謹言慎行。',
            wealth: '偏財運佳，有意外收入機會。但需謹慎理財，避免過度消費。',
            health: '注意泌尿系統和腎臟問題，多喝水保持良好作息。冬季需注意腎臟健康。',
            relationship: '感情上需多溝通，避免誤會產生。單身者易在創意場合認識對象。',
            auspiciousDirections: '北方、西方',
            auspiciousColors: '黑色、藍色'
        },
        '癸': {
            overall: '2025乙巳年對癸水日主是食神坐正財的流年，生活享受與財運並存。乙木為食神，代表生活享受；巳火為正財，代表穩定收入。',
            career: '工作順利，適合穩定發展。但需注意職場競爭，適時展現能力。',
            wealth: '正財收入增加，偏財運普通。適合穩健型投資，避免高風險。',
            health: '注意泌尿系統和腎臟問題，多喝水保持良好作息。秋季需注意腎臟健康。',
            relationship: '感情穩定發展，單身者易在社交場合認識對象。已婚者家庭和諧。',
            auspiciousDirections: '北方、西方',
            auspiciousColors: '黑色、藍色'
        }
    };
    
    // 2026丙午年運勢資料
    const yearlyFortune2026Map = {
        '甲': {
            overall: '2026丙午年對甲木日主是食神坐傷官的流年，才華得以充分展現。丙火為食神，代表創意與表達；午火為傷官，代表才華與技藝。',
            career: '創意與才華得以發揮，適合從事藝術、設計、教育等行業。職場上有表現機會，但需注意與上司的溝通，避免因過度自信產生衝突。',
            wealth: '財運來自才藝與創意，正財穩定，偏財機會多但需謹慎選擇。不宜進行高風險投資，理財以穩健為主。',
            health: '注意心血管健康和眼睛問題，避免過度勞累。夏季火旺，需特別注意降溫防暑。',
            relationship: '單身者魅力提升，易吸引異性注意；已婚者需注意溝通，避免因工作忙碌而忽略家庭。',
            auspiciousDirections: '東方、東南方',
            auspiciousColors: '綠色、藍色',
            importantMonths: '農曆正月、五月、九月'
        },
        '乙': {
            overall: '2026丙午年對乙木日主是傷官坐食神的流年，才華洋溢但需注意言行。丙火為傷官，代表才華與表達；午火為食神，代表創意與享受。',
            career: '才華得以發揮，適合從事創意、藝術、表演等行業。但需注意職場口舌，謹言慎行，避免無意中得罪人。',
            wealth: '財運來自才藝，有意外之財機會。但開銷也大，需注意理財規劃，避免衝動消費。',
            health: '注意神經系統和腸胃問題，保持規律作息。夏季需防中暑與熱相關疾病。',
            relationship: '人際關係活躍，但易有口舌是非。感情上需多些包容與理解，單身者易在社交場合遇到對象。',
            auspiciousDirections: '東方、東南方',
            auspiciousColors: '綠色、紅色',
            importantMonths: '農曆二月、六月、十月'
        },
        '丙': {
            overall: '2026丙午年對丙火日主是比肩坐劫財的流年，人際互動頻繁但需注意資源分配。丙火為比肩，代表人際支援；午火為劫財，代表資源分享與競爭。',
            career: '團隊合作順暢，可藉助他人之力達成目標。但需注意職場競爭，避免與同事發生資源爭奪。',
            wealth: '正財收入穩定，但偏財需謹慎。不宜進行合夥投資，易有財務糾紛。',
            health: '注意心血管健康和眼睛保養，避免過度勞累。夏季火旺，需特別注意降溫。',
            relationship: '人際關係複雜，需謹慎處理。感情上需多溝通，避免誤會產生。',
            auspiciousDirections: '南方、東南方',
            auspiciousColors: '紅色、紫色',
            importantMonths: '農曆四月、八月、十二月'
        },
        '丁': {
            overall: '2026丙午年對丁火日主是劫財坐比肩的流年，人際互動與資源分享並存。丙火為劫財，代表資源分享；午火為比肩，代表人際支援。',
            career: '團隊合作順暢，可藉助他人之力達成目標。但需注意職場競爭，避免與同事發生衝突。',
            wealth: '正財收入穩定，但偏財需謹慎。不宜進行高風險投資，理財以保守為宜。',
            health: '注意心血管健康和睡眠品質，避免用腦過度。夏季需注意降溫防暑。',
            relationship: '人際關係複雜，需謹慎處理。感情上需多溝通，避免誤會產生。',
            auspiciousDirections: '南方、西南方',
            auspiciousColors: '紅色、黃色'
        },
        '戊': {
            overall: '2026丙午年對戊土日主是偏印坐正印的流年，學習成長與貴人相助並存。丙火為偏印，代表靈感與思考；午火為正印，代表貴人與學習。',
            career: '靈感豐富，適合從事研究、策劃等工作。有貴人相助，事業發展順利。',
            wealth: '正財收入增加，偏財運普通。適合穩健型投資，避免高風險。',
            health: '注意腸胃問題和壓力管理，保持規律作息。夏季需注意心血管健康。',
            relationship: '感情穩定發展，單身者易在學習場合認識對象。已婚者家庭和諧。',
            auspiciousDirections: '中央、西南方',
            auspiciousColors: '黃色、紅色'
        },
        '己': {
            overall: '2026丙午年對己土日主是正印坐偏印的流年，貴人相助與學習成長並存。丙火為正印，代表貴人與學習；午火為偏印，代表靈感與思考。',
            career: '有貴人相助，事業發展順利。適合進修學習，提升專業能力。',
            wealth: '正財收入穩定，偏財運普通。適合穩健型投資，避免高風險。',
            health: '注意腸胃問題和壓力管理，保持規律作息。夏季需注意心血管健康。',
            relationship: '感情穩定發展，單身者易在學習場合認識對象。已婚者家庭和諧。',
            auspiciousDirections: '中央、南方',
            auspiciousColors: '黃色、紅色'
        },
        '庚': {
            overall: '2026丙午年對庚金日主是七殺坐正官的流年，挑戰與事業發展並存。丙火為七殺，代表挑戰與壓力；午火為正官，代表事業發展。',
            career: '職場挑戰多，但同時有晉升機會。需展現能力，適時把握機會。',
            wealth: '正財收入增加，偏財運普通。適合穩健型投資，避免高風險。',
            health: '注意呼吸系統和皮膚問題，保持良好作息。夏季需注意心血管健康。',
            relationship: '感情穩定發展，單身者易在工作中認識對象。已婚者家庭和諧。',
            auspiciousDirections: '西方、西北方',
            auspiciousColors: '白色、金色'
        },
        '辛': {
            overall: '2026丙午年對辛金日主是正官坐七殺的流年，事業發展與挑戰並存。丙火為正官，代表事業發展；午火為七殺，代表挑戰與壓力。',
            career: '事業發展順利，有晉升機會。但需注意職場競爭，適時展現能力。',
            wealth: '正財收入增加，偏財運普通。適合穩健型投資，避免高風險。',
            health: '注意呼吸系統和皮膚問題，保持良好作息。夏季需注意心血管健康。',
            relationship: '感情穩定發展，單身者易在工作中認識對象。已婚者家庭和諧。',
            auspiciousDirections: '西方、西北方',
            auspiciousColors: '白色、金色'
        },
        '壬': {
            overall: '2026丙午年對壬水日主是偏財坐正財的流年，財運亨通。丙火為偏財，代表意外收入；午火為正財，代表穩定收入。',
            career: '財運亨通，適合拓展業務，增加收入來源。但需注意職場競爭，適時展現能力。',
            wealth: '偏財運佳，有意外收入機會。但需謹慎理財，避免過度消費。',
            health: '注意泌尿系統和腎臟問題，多喝水保持良好作息。夏季需注意降溫防暑。',
            relationship: '感情穩定發展，單身者易在社交場合認識對象。已婚者家庭和諧。',
            auspiciousDirections: '北方、西方',
            auspiciousColors: '黑色、藍色'
        },
        '癸': {
            overall: '2026丙午年對癸水日主是正財坐偏財的流年，財運穩定增長。丙火為正財，代表穩定收入；午火為偏財，代表意外收入。',
            career: '工作順利，適合穩定發展。有晉升機會，需適時把握。',
            wealth: '正財收入增加，偏財運佳。適合穩健型投資，避免高風險。',
            health: '注意泌尿系統和腎臟問題，多喝水保持良好作息。夏季需注意降溫防暑。',
            relationship: '感情穩定發展，單身者易在社交場合認識對象。已婚者家庭和諧。',
            auspiciousDirections: '北方、西方',
            auspiciousColors: '黑色、藍色'
        }
    };
    
    // 五行對照表
    const wuxingMap = {
        // 天干
        '甲': '木', '乙': '木',
        '丙': '火', '丁': '火',
        '戊': '土', '己': '土',
        '庚': '金', '辛': '金',
        '壬': '水', '癸': '水',
        // 地支
        '子': '水', '亥': '水',
        '寅': '木', '卯': '木',
        '巳': '火', '午': '火',
        '申': '金', '酉': '金',
        '辰': '土', '戌': '土', '丑': '土', '未': '土'
    };
    
    // 喜用神分析資料
    const xishenMap = {
        '木': {
            strong: '木旺，喜用神為金、火、土。可多用白色、金色、紅色、紫色、黃色。',
            weak: '木弱，喜用神為水、木。可多用黑色、藍色、綠色。',
            neutral: '木中和，喜用神為水、木。可多用黑色、藍色、綠色。'
        },
        '火': {
            strong: '火旺，喜用神為水、金、土。可多用黑色、藍色、白色、金色、黃色。',
            weak: '火弱，喜用神為木、火。可多用綠色、紅色、紫色。',
            neutral: '火中和，喜用神為木、火。可多用綠色、紅色、紫色。'
        },
        '土': {
            strong: '土旺，喜用神為木、金、水。可多用綠色、白色、金色、黑色、藍色。',
            weak: '土弱，喜用神為火、土。可多用紅色、紫色、黃色。',
            neutral: '土中和，喜用神為火、土。可多用紅色、紫色、黃色。'
        },
        '金': {
            strong: '金旺，喜用神為火、木、水。可多用紅色、紫色、綠色、黑色、藍色。',
            weak: '金弱，喜用神為土、金。可多用黃色、白色、金色。',
            neutral: '金中和，喜用神為土、金。可多用黃色、白色、金色。'
        },
        '水': {
            strong: '水旺，喜用神為土、火、木。可多用黃色、紅色、紫色、綠色。',
            weak: '水弱，喜用神為金、水。可多用白色、金色、黑色、藍色。',
            neutral: '水中和，喜用神為金、水。可多用白色、金色、黑色、藍色。'
        }
    };
    
    // 袁天罡稱骨算命資料
    // 年骨重對照表（簡化版，以60甲子為基礎）
    const yearBoneWeight = {
        '甲子': 1.2, '乙丑': 0.9, '丙寅': 0.6, '丁卯': 0.7, '戊辰': 1.2,
        '己巳': 0.5, '庚午': 0.9, '辛未': 0.8, '壬申': 0.7, '癸酉': 0.8,
        '甲戌': 1.5, '乙亥': 0.9, '丙子': 1.6, '丁丑': 0.8, '戊寅': 0.8,
        '己卯': 1.9, '庚辰': 1.2, '辛巳': 0.6, '壬午': 0.8, '癸未': 0.7,
        '甲申': 0.5, '乙酉': 1.5, '丙戌': 0.6, '丁亥': 1.6, '戊子': 1.5,
        '己丑': 0.7, '庚寅': 0.9, '辛卯': 1.2, '壬辰': 1.0, '癸巳': 0.7,
        '甲午': 1.5, '乙未': 0.6, '丙申': 0.5, '丁酉': 1.4, '戊戌': 1.4,
        '己亥': 0.9, '庚子': 0.7, '辛丑': 0.7, '壬寅': 0.9, '癸卯': 1.2,
        '甲辰': 0.8, '乙巳': 0.7, '丙午': 1.3, '丁未': 0.5, '戊申': 1.4,
        '己酉': 0.5, '庚戌': 0.9, '辛亥': 1.7, '壬子': 0.5, '癸丑': 0.7,
        '甲寅': 1.2, '乙卯': 0.8, '丙辰': 0.8, '丁巳': 0.6, '戊午': 1.9,
        '己未': 0.6, '庚申': 0.8, '辛酉': 1.6, '壬戌': 1.0, '癸亥': 0.7
    };
    
    // 月骨重對照表（農曆月份）
    const monthBoneWeight = {
        1: 0.6, 2: 0.7, 3: 1.8, 4: 0.9, 5: 0.5, 6: 1.6,
        7: 0.9, 8: 1.5, 9: 1.8, 10: 0.8, 11: 0.9, 12: 0.5
    };
    
    // 日骨重對照表（農曆日期）
    const dayBoneWeight = {
        1: 0.5, 2: 1.0, 3: 0.8, 4: 1.5, 5: 1.6, 6: 1.5,
        7: 0.8, 8: 1.6, 9: 0.8, 10: 1.6, 11: 0.9, 12: 1.7,
        13: 0.8, 14: 1.7, 15: 1.0, 16: 0.8, 17: 0.9, 18: 1.8,
        19: 0.5, 20: 1.5, 21: 1.0, 22: 0.9, 23: 0.8, 24: 0.9,
        25: 1.5, 26: 1.8, 27: 0.7, 28: 0.8, 29: 1.6, 30: 0.6
    };
    
    // 時辰骨重對照表
    const hourBoneWeight = {
        0: 1.6, 1: 0.6, 3: 0.7, 5: 1.0, 7: 0.9, 9: 1.6,
        11: 1.0, 13: 0.8, 15: 0.8, 17: 0.9, 19: 0.6, 21: 0.6,
        23: 1.6
    };
    
    // 稱骨歌對照表
    const boneSongMap = {
        2.1: "短命非業謂大空，平生災難事重重，<p></p>凶禍頻臨陷逆境，終世困苦事不成。",
        2.2: "身寒骨冷苦伶仃，此命推來行乞人，<p></p>勞勞碌碌無度日，終年打拱過平生。",
        2.3: "此命推來骨格輕，求謀作事事難成，<p></p>妻兒兄弟應難許，別處他鄉作散人。",
        2.4: "此命推來福祿無，門庭困苦總難榮，<p></p>六親骨肉皆無靠，流浪他鄉作老翁。",
        2.5: "此命推來祖業微，門庭營度似稀奇，<p></p>六親骨肉如冰炭，一世勤勞自把持。",
        2.6: "平生衣祿苦中求，獨自營謀事不休，<p></p>離祖出門宜早計，晚來衣祿自無休。",
        2.7: "一生作事少商量，難靠祖宗作主張，<p></p>獨馬單槍空做去，早年晚歲總無長。",
        2.8: "一生行事似飄蓬，祖宗產業在夢中，<p></p>若不過房改名姓，也當移徒二三通。",
        2.9: "初年運限未曾亨，縱有功名在後成，<p></p>須過四旬才可立，移居改姓始為良。",
        3.0: "勞勞碌碌苦中求，東奔西走何日休，<p></p>若使終身勤與儉，老來稍可免憂愁。",
        3.1: "忙忙碌碌苦中求，何日雲開見日頭，<p></p>難得祖基家可立，中年衣食漸無憂。",
        3.2: "初年運蹇事難謀，漸有財源如水流，<p></p>到得中年衣食旺，那時名利一齊收。",
        3.3: "早年做事事難成，百年勤勞枉費心，<p></p>半世自如流水去，後來運到始得金。",
        3.4: "此命福氣果如何，僧道門中衣祿多，<p></p>離祖出家方為妙，朝晚拜佛念彌陀。",
        3.5: "生平福量不周全，祖業根基覺少傳，<p></p>營事生涯宜守舊，時來衣食勝從前。",
        3.6: "不須勞碌過平生，獨自成家福不輕，<p></p>早有福星常照命，任君行去百般成。",
        3.7: "此命般般事不成，弟兄少力自孤行，<p></p>雖然祖業須微有，來得明時去不明。",
        3.8: "一身骨肉最清高，早入簧門姓氏標，<p></p>待到年將三十六，藍衫脫去換紅袍。",
        3.9: "此命終身運不通，勞勞作事盡皆空，<p></p>苦心竭力成家計，到得那時在夢中。",
        4.0: "平生衣祿是綿長，件件心中自主張，<p></p>前面風霜多受過，後來必定享安康。",
        4.1: "此命推來事不同，為人能幹異凡庸，<p></p>中年還有逍遙福，不比前時運未通。",
        4.2: "得寬懷處且寬懷，何用雙眉皺不開，<p></p>若使中年命運濟，那時名利一齊來。",
        4.3: "為人心性最聰明，作事軒昂近貴人，<p></p>衣祿一生天數定，不須勞碌是豐亨。",
        4.4: "萬事由天莫苦求，須知福祿命裡收，<p></p>少壯名利難如意，晚景欣然更不憂。",
        4.5: "名利推來竟若何，前番辛苦後奔波，<p></p>命中難養男與女，骨肉扶持也不多。",
        4.6: "東西南北盡皆通，出姓移名更覺隆，<p></p>衣祿無虧天數定，中年晚景一般同。",
        4.7: "此命推來旺末年，妻榮子貴自怡然，<p></p>平生原有滔滔福，可有財源如水流。",
        4.8: "初年運道未曾亨，若是蹉跎再不興，<p></p>兄弟六親皆無靠，一身事業晚年成。",
        4.9: "此命推來福不輕，自成自立顯門庭，<p></p>從來富貴人親近，使婢差奴過一生。",
        5.0: "為利為名終日勞，中年福祿也多遭，<p></p>老來是有財星照，不比前番目下高。",
        5.1: "一世榮華事事通，不須勞碌自亨通，<p></p>兄弟叔姪皆如意，家業成時福祿宏。",
        5.2: "一世亨通事事能，不須勞苦自然寧，<p></p>宗族有光欣喜甚，家產豐盈自稱心。",
        5.3: "此格推來氣象真，興家發達在其中，<p></p>一生福祿安排定，卻是人間一富翁。",
        5.4: "此命推來厚且清，詩書滿腹看功成，<p></p>豐衣足食自然穩，正是人間有福人。",
        5.5: "走馬揚鞭爭利名，少年作事費籌論，<p></p>一朝福祿源源至，富貴榮華顯六親。",
        5.6: "此格推來禮義通，一生福祿用無窮，<p></p>甜酸苦辣皆嘗過，財源滾滾穩且豐。",
        5.7: "福祿豐盈萬事全，一生榮耀顯雙親，<p></p>名揚威振人欽敬，處世逍遙似遇春。",
        5.8: "平生福祿自然來，名利兼全福壽偕，<p></p>雁塔題名為貴客，紫袍金帶走金階。",
        5.9: "細推此格妙且清，必定才高禮義通，<p></p>甲第之中應有分，揚鞭走馬顯威榮。",
        6.0: "一朝金榜快題名，顯祖榮宗立大功，<p></p>衣祿定然原裕足，田園財帛更豐盈。",
        6.1: "不作朝中金榜客，定為世上大財翁，<p></p>聰明天賦經書熟，名顯高科自是榮。",
        6.2: "此命生來福不窮，讀書必定顯親宗，<p></p>紫衣金帶為卿相，富貴榮華皆可同。",
        6.3: "命主為官福祿長，得來富貴實非常，<p></p>名題雁塔傳金榜，定中高科天下揚。",
        6.4: "此格威權不可當，紫袍金帶坐高堂，<p></p>榮華富貴誰能及，積玉堆金滿儲倉。",
        6.5: "細推此命福不輕，安國安邦極品人，<p></p>文繡雕梁政富貴，威聲照耀四方聞。",
        6.6: "此格人間一福人，堆金積玉滿堂春，<p></p>從來富貴由天定，正笏垂紳謁聖君。",
        6.7: "此命生來福自宏，田園家業最高隆，<p></p>平生衣祿豐盈足，一世榮華萬事通。",
        6.8: "富貴由天莫苦求，萬金家計不須謀，<p></p>十年不比前番事，祖業根基水上舟。",
        6.9: "君是人間衣祿星，一生福貴眾人欽，<p></p>縱然福祿由天定，安享榮華過一生。",
        7.0: "此命推來福不輕，不須愁慮苦勞心，<p></p>一生天定衣與祿，富貴榮華主一生。",
        7.1: "此命生來大不同，公侯卿相在其中，<p></p>一生自有逍遙福，富貴榮華極品隆。"
    };
    
    // 切換年份顯示
    function switchYear(year) {
        // 更新標籤狀態
        document.querySelectorAll('.year-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        if (year === '2025') {
            document.querySelector('.year-tab.blue').classList.add('active');
        } else {
            document.querySelector('.year-tab.green').classList.add('active');
        }
        
        // 更新內容顯示
        document.querySelectorAll('.year-content').forEach(content => {
            content.classList.remove('active');
        });
        
        document.getElementById(`year${year}Content`).classList.add('active');
    }
    
    // 計算八字五行比例
    function calculateWuxing(bazi) {
        const wuxingCount = {
            '金': 0, '木': 0, '水': 0, '火': 0, '土': 0
        };
        
        // 分析八字四柱的五行
        bazi.forEach(pillar => {
            const gan = pillar.substring(0, 1);
            const zhi = pillar.substring(1, 2);
            
            // 天干五行
            if (wuxingMap[gan]) {
                wuxingCount[wuxingMap[gan]]++;
            }
            
            // 地支五行
            if (wuxingMap[zhi]) {
                wuxingCount[wuxingMap[zhi]]++;
            }
        });
        
        return wuxingCount;
    }
    
    // 判斷喜用神
    function determineXishen(dayGan, wuxingCount) {
        const dayElement = wuxingMap[dayGan];
        const total = Object.values(wuxingCount).reduce((a, b) => a + b, 0);
        const dayElementCount = wuxingCount[dayElement] || 0;
        
        let strength = 'neutral';
        if (total > 0) {
            const percentage = (dayElementCount / total) * 100;
            if (percentage > 30) {
                strength = 'strong';
            } else if (percentage < 15) {
                strength = 'weak';
            }
        }
        
        return xishenMap[dayElement][strength];
    }
    
    // 計算稱骨算命
    function calculateBoneWeight(lunar, hourVal) {
        const yearGanZhi = lunar.getYearInGanZhi();
        const month = lunar.getMonth();
        const day = lunar.getDay();
        
        // 獲取年骨重
        const yearWeight = yearBoneWeight[yearGanZhi] || 1.0;
        
        // 獲取月骨重
        const monthWeight = monthBoneWeight[month] || 1.0;
        
        // 獲取日骨重
        const dayWeight = dayBoneWeight[day] || 1.0;
        
        // 獲取時辰骨重
        let hourWeight = 1.0;
        for (const key in hourBoneWeight) {
            if (hourVal >= parseInt(key)) {
                hourWeight = hourBoneWeight[key];
            }
        }
        
        // 計算總骨重
        const totalWeight = yearWeight + monthWeight + dayWeight + hourWeight;
        
        return {
            yearWeight,
            monthWeight,
            dayWeight,
            hourWeight,
            totalWeight: parseFloat(totalWeight.toFixed(1))
        };
    }
    
    // 獲取稱骨歌
    function getBoneSong(totalWeight) {
        // 四捨五入到小數點後一位
        const roundedWeight = Math.round(totalWeight * 10) / 10;
        
        // 尋找最接近的稱骨歌
        let closestKey = Object.keys(boneSongMap).reduce((prev, curr) => {
            return Math.abs(curr - roundedWeight) < Math.abs(prev - roundedWeight) ? curr : prev;
        });
        
        return boneSongMap[closestKey] || "此命推來福自宏，田園家業最高隆，平生衣祿豐盈足，一世榮華萬事通。";
    }
    
    function run() {
        try {
            const dateVal = document.getElementById('myDate').value;
            const hourVal = parseInt(document.getElementById('myHour').value);
            if (!dateVal) {
                alert("請選擇出生日期");
                return;
            }

            const d = dateVal.split('-');
            const solar = Solar.fromYmdHms(parseInt(d[0]), parseInt(d[1]), parseInt(d[2]), hourVal, 0, 0);
            const lunar = solar.getLunar();
            
            const y = lunar.getYearInGanZhi();
            const m = lunar.getMonthInGanZhi();
            const d_gz = lunar.getDayInGanZhi();
            const t = lunar.getTimeInGanZhi();

            // 顯示農曆資訊
            document.getElementById('lunarInfo').innerText = 
                `農曆：${lunar.getYearInGanZhi()}年 ${lunar.getMonthInChinese()}月 ${lunar.getDayInChinese()}日 (${lunar.getYearShengXiao()}年)`;

            // 顯示八字
            const baziItems = [
                { t: '年柱', v: y }, { t: '月柱', v: m },
                { t: '日柱', v: d_gz }, { t: '時柱', v: t }
            ];
            document.getElementById('baziDisplay').innerHTML = baziItems.map(i => `
                <div class="bazi-item">
                    <div class="bazi-t">${i.t}</div>
                    <div class="bazi-v">${i.v}</div>
                </div>
            `).join('');

            // 取得日元 (日柱的第一個字)
            const dayGan = d_gz.substring(0, 1);
 
            // 顯示日元分析
            const dayAnalysis = dayAnalysisMap[dayGan];
            if (dayAnalysis) {
                document.getElementById('charText').innerHTML = `
                    <h3>${dayAnalysis.title}</h3>
                    <p><strong>基本性格：</strong>${dayAnalysis.characteristics}</p>
                    <p><strong>優點：</strong>${dayAnalysis.strengths}</p>
                    <p><strong>缺點：</strong>${dayAnalysis.weaknesses}</p>
                    <p><strong>職業建議：</strong>${dayAnalysis.careerSuggestions}</p>
                    <p><strong>人際建議：</strong>${dayAnalysis.relationshipAdvice}</p>
                `;
            } else {
                document.getElementById('charText').innerText = '日元分析資料暫缺';
            }

            // 計算五行比例與喜用神
            const baziArray = [y, m, d_gz, t];
            const wuxingCount = calculateWuxing(baziArray);
            const xishenAdvice = determineXishen(dayGan, wuxingCount);
            
            // 計算五行比例百分比
            const total = Object.values(wuxingCount).reduce((a, b) => a + b, 0);
            const wuxingPercentages = {};
            Object.keys(wuxingCount).forEach(element => {
                wuxingPercentages[element] = total > 0 ? Math.round((wuxingCount[element] / total) * 100) : 0;
            });
            
            // 顯示五行比例與喜用神
            document.getElementById('wuxingText').innerHTML = `
                <h3>八字五行比例</h3>
                <div class="wuxing-stats">
                    <div class="wuxing-item metal">金: ${wuxingCount['金']} (${wuxingPercentages['金']}%)</div>
                    <div class="wuxing-item wood">木: ${wuxingCount['木']} (${wuxingPercentages['木']}%)</div>
                    <div class="wuxing-item water">水: ${wuxingCount['水']} (${wuxingPercentages['水']}%)</div>
                    <div class="wuxing-item fire">火: ${wuxingCount['火']} (${wuxingPercentages['火']}%)</div>
                    <div class="wuxing-item earth">土: ${wuxingCount['土']} (${wuxingPercentages['土']}%)</div>
                </div>
                <div class="xishen-box">
                    <p><strong>喜用神分析：</strong>${xishenAdvice}</p>
                    <p><strong>日主五行：</strong>${wuxingMap[dayGan]} (${dayGan})</p>
                    <p><strong>五行平衡建議：</strong>根據八字五行比例，建議在生活中多使用喜用神相關的元素、顏色和方位，以達到五行平衡，改善運勢。</p>
                </div>
            `;

            // 計算稱骨算命
            const boneWeight = calculateBoneWeight(lunar, hourVal);
            const boneSong = getBoneSong(boneWeight.totalWeight);
            
            // 顯示稱骨算命結果
            document.getElementById('boneWeightText').innerHTML = `
                <div class="bone-weight-box">
                    <div class="bone-weight-title">您的命骨總重</div>
                    <div class="bone-weight-value">${boneWeight.totalWeight} 兩</div>
                    <div>年骨重: ${boneWeight.yearWeight}兩 |月骨重: ${boneWeight.monthWeight}兩 <p></p>日骨重: ${boneWeight.dayWeight}兩 |時骨重: ${boneWeight.hourWeight}兩</div>
                </div>
                <div class="bone-song-box">
                    <h3>稱骨歌</h3>
                    <p>${boneSong}</p>
                </div>
            `;

            // 顯示2025年運勢
            const yearFortune2025 = yearlyFortune2025Map[dayGan];
            if (yearFortune2025) {
                document.getElementById('yearText2025').innerHTML = `
                    <h3>2025乙巳年整體運勢</h3>
                    <p><strong>總論：</strong>${yearFortune2025.overall}</p>
                    <div class="fortune-grid">
                        <div class="fortune-category">
                            <strong>事業運：</strong><br>${yearFortune2025.career}
                        </div>
                        <div class="fortune-category">
                            <strong>財富運：</strong><br>${yearFortune2025.wealth}
                        </div>
                        <div class="fortune-category">
                            <strong>健康運：</strong><br>${yearFortune2025.health}
                        </div>
                        <div class="fortune-category">
                            <strong>感情運：</strong><br>${yearFortune2025.relationship}
                        </div>
                    </div>
                    <p><strong>吉利方位：</strong> ${yearFortune2025.auspiciousDirections}</p>
                    <p><strong>幸運顏色：</strong> ${yearFortune2025.auspiciousColors}</p>
                    ${yearFortune2025.importantMonths ? `<p><strong>重要月份：</strong> ${yearFortune2025.importantMonths}</p>` : ''}
                `;
            } else {
                document.getElementById('yearText2025').innerHTML = `
                    <h3>2025乙巳年整體運勢</h3>
                    <p>${getSimpleYearFortune(dayGan, '2025')}</p>
                `;
            }
            
            // 顯示2026年運勢
            const yearFortune2026 = yearlyFortune2026Map[dayGan];
            if (yearFortune2026) {
                document.getElementById('yearText2026').innerHTML = `
                    <h3>2026丙午年整體運勢</h3>
                    <p><strong>總論：</strong>${yearFortune2026.overall}</p>
                    <div class="fortune-grid">
                        <div class="fortune-category">
                            <strong>事業運：</strong><br>${yearFortune2026.career}
                        </div>
                        <div class="fortune-category">
                            <strong>財富運：</strong><br>${yearFortune2026.wealth}
                        </div>
                        <div class="fortune-category">
                            <strong>健康運：</strong><br>${yearFortune2026.health}
                        </div>
                        <div class="fortune-category">
                            <strong>感情運：</strong><br>${yearFortune2026.relationship}
                        </div>
                    </div>
                    <p><strong>吉利方位：</strong> ${yearFortune2026.auspiciousDirections}</p>
                    <p><strong>幸運顏色：</strong> ${yearFortune2026.auspiciousColors}</p>
                    ${yearFortune2026.importantMonths ? `<p><strong>重要月份：</strong> ${yearFortune2026.importantMonths}</p>` : ''}
                `;
            } else {
                document.getElementById('yearText2026').innerHTML = `
                    <h3>2026丙午年整體運勢</h3>
                    <p>${getSimpleYearFortune(dayGan, '2026')}</p>
                `;
            }

            document.getElementById('result').style.display = 'block';
            
            // 滾動到結果區域
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
            
        } catch (e) {
            alert("抱歉，發生錯誤。請確認您的手機網路連線正常。");
            console.error(e);
        }
    }
    
    // 簡單年度運勢（備用）
    function getSimpleYearFortune(dayGan, year) {
        const year2025Map = {
            '甲': '2025年劫財流年，朋友交往多，需防財物耗散。',
            '乙': '2025年比肩流年，競爭壓力大，適合團隊合作。',
            '丙': '2025年印星流年，有貴人相助，利於學習與進修。',
            '丁': '2025年偏印流年，靈感豐富，但要注意身心壓力。',
            '戊': '2025年官殺流年，職場挑戰多，是磨練意志的時期。',
            '己': '2025年正官流年，事業有提升機會，宜守規守法。',
            '庚': '2025年財星流年，財運機會增加，利於開展業務。',
            '辛': '2025年偏財流年，有意外收入機會，但投資需謹慎。',
            '壬': '2025年傷官流年，才華能發揮，但要注意職場口舌。',
            '癸': '2025年食神流年，生活享受多，心情愉快順遂。'
        };
        
        const year2026Map = {
            '甲': '2026年食神流年，才華得以發揮，但需注意健康。',
            '乙': '2026年傷官流年，創意豐富，但需注意職場口舌。',
            '丙': '2026年比肩流年，人際關係活躍，適合團隊合作。',
            '丁': '2026年劫財流年，需注意財務管理，避免不必要的開銷。',
            '戊': '2026年偏印流年，學習運佳，適合進修深造。',
            '己': '2026年正印流年，貴人運強，事業發展順利。',
            '庚': '2026年七殺流年，挑戰多但機會也多，需把握時機。',
            '辛': '2026年正官流年，事業發展順利，有晉升機會。',
            '壬': '2026年偏財流年，財運亨通，有意外收入機會。',
            '癸': '2026年正財流年，財運穩定增長，適合穩健投資。'
        };
        
        if (year === '2025') {
            return year2025Map[dayGan] || '2025年運勢計算中...';
        } else {
            return year2026Map[dayGan] || '2026年運勢計算中...';
        }
    }
</script>

</body>
</html>